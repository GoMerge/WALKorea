<!DOCTYPE html>
<html lang="ko">
    <style>
        .social-login {
            display: flex;
            gap: 8px;
            justify-content: space-between;
        }

        .btn-oauth {
            flex: 1;
            height: 44px;
            border-radius: 999px;
            font-size: 14px;
            font-weight: 500;
            border-width: 1px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0 12px;
        }

        .btn-oauth + .btn-oauth {
            margin-left: 0;
        }

        .oauth-logo {
            width: 18px;
            height: 18px;
            margin-right: 6px;
        }

        /* 개별 색상만 다르게 */
        .btn-oauth-naver {
            background-color: #03c75a;
            border-color: #03c75a;
            color: #fff;
        }

        .btn-oauth-google {
            background-color: #f5f5f5;   /* 이전: #fff */
            border-color: #d0d0d0;       /* 살짝 진한 회색 */
            color: #444;
        }

        .btn-oauth-google:hover {
            background-color: #e8e8e8;
            border-color: #c4c4c4;
        }

        .btn-oauth-kakao {
            background-color: #fee500;
            border-color: #fee500;
            color: #3c1e1e;
        }
    </style>
<head>
    <!-- 지도 구현 -->
  <script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=fd93df643bf67f10524ef70aafa1a1a6"></script>
  <base href="/">
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Property Details - TheProperty Bootstrap Template</title>
  <meta name="description" content="">
  <meta name="keywords" content="">

  

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">
  <link href="assets/vendor/drift-zoom/drift-basic.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="assets/css/main.css" rel="stylesheet">

  <!-- =======================================================
  * Template Name: TheProperty
  * Template URL: https://bootstrapmade.com/theproperty-bootstrap-real-estate-template/
  * Updated: Aug 05 2025 with Bootstrap v5.3.7
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
    
</head>
<body>
  <header id="header" class="header d-flex align-items-center fixed-top">
    <div class="header-container container-fluid container-xl position-relative d-flex align-items-center justify-content-between">
      
      <!-- Logo -->
      <a href="/" class="logo d-flex align-items-center me-auto me-xl-0">
        <h1 class="sitename">WALKorea</h1>
      </a>

      <!-- Navigation Menu -->
      <nav id="navmenu" class="navmenu">
        <ul>
          <li class="dropdown">
            <a href="/"><span>여행정보</span> <i class="bi bi-chevron-down toggle-dropdown"></i></a>
            <ul>
              <li><a href="/places/list?contenttypeid=12&page=1&sort=updated">관광지</a></li>
              <li><a href="/places/list?contenttypeid=14&page=1&sort=updated">문화시설</a></li>
              <li><a href="/places/list?contenttypeid=15&page=1&sort=updated">축제</a></li>
              <li><a href="/places/list?contenttypeid=32&page=1&sort=updated">숙박</a></li>
              <li><a href="/places/list?contenttypeid=39&page=1&sort=updated">음식점</a></li>
              <li><a href="/places/list?contenttypeid=38&page=1&sort=updated">쇼핑</a></li>
              <li><a href="/places/list?contenttypeid=28&page=1&sort=updated">레포츠</a></li>
            </ul>
          </li>
          <li><a href="/places/map_more">지도</a></li>
          <li><a href="/mypage_calendar">마이페이지</a></li>
        </ul>
      </nav>

      <!-- 비로그인: 로그인/회원가입 버튼 (기존 스타일 적용) -->
      <div id="nav-guest" class="d-flex align-items-center gap-2">
        <a class="btn-getstarted" href="/signup">회원가입</a>
        <a class="btn-getstarted" href="/login">로그인</a>
      </div>

      <!-- 로그인: 알림/닉네임/로그아웃 (기존 스타일 적용) -->
      <div id="nav-user" class="d-none d-flex align-items-center gap-3">

        <!-- 알림 버튼 (작게) -->
        <div class="dropdown">
          <button id="notifDropdown"
                  class="btn btn-outline-success btn-sm position-relative px-2 py-1 dropdown-toggle"
                  type="button"
                  data-bs-toggle="dropdown"
                  aria-expanded="false">
            <i class="bi bi-bell"></i>
            <span id="notif-badge"
                  class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger d-none small">
              0
            </span>
          </button>

          <div class="dropdown-menu dropdown-menu-end notif-dropdown">
            <div class="notif-header d-flex justify-content-between align-items-center">
              <span class="fw-semibold">알림</span>
              <button id="notif-clear-all" class="btn btn-link btn-sm text-danger p-0">전체삭제</button>
            </div>
            <div class="notif-body">
              <p id="notif-empty-text" class="notif-empty text-muted small mb-2">
                아직 알림이 없습니다.
              </p>
              <ul id="notif-list" class="notif-list list-unstyled mb-0"></ul>
            </div>
          </div>
        </div>

        <!-- 닉네임 + 라벨 -->
        <div class="d-flex align-items-center gap-2">
          <div id="header-initial"
              class="mypage-user-badge"
              style="width:32px; height:32px; font-size:16px; margin-right:0;">
            닉네임
          </div>
          <span id="header-nickname" class="fw-semibold"></span>
        </div>

        <!-- 로그아웃 버튼: 로그인/회원가입 버튼 스타일 재사용 -->
        <button id="nav-logout" class="btn-getstarted btn-logout-small">
          로그아웃
        </button>
      </div>
    </div>
  </header>
  <main class="main">

    <!-- Page Title -->
    <div class="page-title">
      <div class="heading">
        <div class="container">
          <div class="row d-flex justify-content-center text-center">
            <div class="col-lg-8">
              <h1 class="heading-title">비밀번호 찾기</h1>
            </div>
          </div>
        </div>
      </div>
      <nav class="breadcrumbs">
        <div class="container">
          <ol>
            <li><a href="/">WALKorea</a></li>
            <li class="current">비밀번호 찾기</li>
          </ol>
        </div>
      </nav>
    </div>
    <section class="section">
    <div class="container" style="max-width: 500px;">
      <!-- 1단계: 재설정 코드 요청 -->
      <div class="card shadow-sm mb-4">
        <div class="card-body">
          <h5 class="card-title mb-3">비밀번호 재설정 코드 받기</h5>
          <form id="request-form">
            <div class="mb-3">
              <label for="userid" class="form-label">아이디</label>
              <input type="text" class="form-control" id="userid" name="userid" placeholder="아이디를 입력하세요" required>
            </div>
            <div class="mb-3">
              <label for="email" class="form-label">이메일</label>
              <input type="email" class="form-control" id="email" name="email" placeholder="가입 시 사용한 이메일" required>
            </div>
            <button type="submit" class="btn btn-success w-100">
              인증 코드 보내기
            </button>
          </form>
        </div>
      </div>

      <!-- 2단계: 코드 입력 + 새 비밀번호 -->
      <div class="card shadow-sm" id="reset-form" style="display:none;">
        <div class="card-body">
          <h5 class="card-title mb-3">새 비밀번호 설정</h5>
          <form>
            <div class="mb-3">
              <label for="verification_code" class="form-label">인증 코드</label>
              <input type="text" class="form-control" id="verification_code" name="verification_code" placeholder="이메일로 받은 코드" required>
            </div>
            <div class="mb-3">
              <label for="new_password" class="form-label">새 비밀번호</label>
              <input type="password" class="form-control" id="new_password" name="new_password" placeholder="새 비밀번호" required>
            </div>
            <div class="mb-3">
              <label for="new_password_confirm" class="form-label">새 비밀번호 확인</label>
              <input type="password" class="form-control" id="new_password_confirm" name="new_password_confirm" placeholder="새 비밀번호 다시 입력" required>
            </div>
            <button type="submit" class="btn btn-primary w-100">
              비밀번호 변경하기
            </button>
          </form>
        </div>
      </div>
    </div>
  </section>
  </main>
  <footer id="footer" class="footer position-relative">


    <div class="footer-bottom">
      <div class="container">
        <div class="row align-items-center">
          <div class="col-lg-6">
            <div class="copyright">
              <p>© <span>WALKorea</span></p>
            </div>
          </div>
          <div class="col-lg-6">
            <div class="footer-bottom-links">
              <a href="#">개발자 김혜영</a>
              <a href="#">개발자 이지영</a>
            </div>
            <div class="credits">
            </div>
          </div>
        </div>
      </div>
    </div>

  </footer>

<script>
  const API_BASE = "";
// 1단계: 비밀번호 재설정 코드 요청
document.getElementById("request-form").addEventListener("submit", async function(e) {
  e.preventDefault();
  const form = e.target;
  const payload = {
    userid: form.userid.value.trim(),
    email: form.email.value.trim()
  };
  if (!payload.userid || !payload.email) {
    alert("아이디와 이메일을 모두 입력하세요.");
    return;
  }
  const res = await fetch(API_BASE + "/user/password-reset-request", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify(payload)
  });
  if (res.ok) {
    alert("인증코드가 이메일로 전송되었습니다. 메일함을 확인하세요.");
    const resetFormCard = document.getElementById("reset-form");
    resetFormCard.style.display = "block";

    resetFormCard.dataset.userid = payload.userid;
    resetFormCard.dataset.email = payload.email;
  } else {
    const err = await res.json().catch(()=>null);
    let message = "비밀번호 재설정 요청에 실패했습니다.";
    if (err && err.detail) {
      if (Array.isArray(err.detail) && err.detail.length > 0) {
        message = err.detail[0].msg || message;
      } else if (typeof err.detail === "string") {
        message = err.detail;
      }
    }
    alert(message);
  }
});

// 2단계: 코드 + 새 비밀번호로 실제 변경
document
  .querySelector("#reset-form form")
  .addEventListener("submit", async function (e) {
    e.preventDefault();
    const form = e.target;
    const card = document.getElementById("reset-form");

    const userid = card.dataset.userid || document.getElementById("userid").value.trim();
    const email  = card.dataset.email  || document.getElementById("email").value.trim();

    const code = form.verification_code.value.trim();
    const pw   = form.new_password.value;
    const pw2  = form.new_password_confirm.value;

    if (!userid || !email) {
      alert("아이디/이메일 정보가 없습니다. 처음 단계부터 다시 진행해 주세요.");
      return;
    }

    if (!code || !pw || !pw2) {
      alert("모든 필드를 입력해주세요.");
      return;
    }
    if (pw !== pw2) {
      alert("새 비밀번호와 확인이 일치하지 않습니다.");
      return;
    }

    const payload = {
      userid: userid,
      email: email,
      verification_code: code,
      new_password: pw
    };

    console.log("reset payload:", payload);

    const res = await fetch(API_BASE + "/user/password-reset-confirm", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload),
    });

    if (res.ok) {
      alert("비밀번호가 성공적으로 변경되었습니다. 새 비밀번호로 로그인해주세요.");
      window.location.href = "/login";
    } else {
      const err = await res.json().catch(() => null);
      console.log("reset error:", JSON.stringify(err, null, 2));
      let message = "비밀번호 변경에 실패했습니다.";
      if (err && err.detail) {
        if (Array.isArray(err.detail) && err.detail.length > 0) {
          message = err.detail[0].msg || message;
        } else if (typeof err.detail === "string") {
          message = err.detail;
        }
      }
      alert(message);
    }
  });
</script>
</body>
</html>
